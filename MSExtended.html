<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rasmus Göransson - Minesweeper Extended</title>
    <link rel="stylesheet" href="output.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&display=swap">

    <link rel="stylesheet" href="../ScriptStyle/prism-vsc-dark-plus.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-csharp.min.js"></script>
</head>

<body class="bg-zinc-800 text-white font-exo2">

    <header>
        <div>
            <nav>
                <ul class="flex text-center justify-center pt-4">
                    <li><a href="index.html" class="nav-link text-xl">HOME</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 text-white">
        
        <div id="top" class="flex flex-col md:flex-row md:space-x-8">
            <!-- MINESWEEPER -->
            <section class="md:w-3/5 bg-zinc-900 bg-opacity-90 p-4 rounded-md text-lg leading-8">
                <h2 class="text-4xl font-semibold mb-4 text-green-500">Minesweeper Extended</h2>
                <p class="py-4">
                    Minesweeper Extended offers a gathered place to play the original classic take on Minesweeper, same rules, same style. 
                    Or, you could try some completely different styles of the original! 
                    <br>
                    Play Hex mode, an entirely different grid style.
                    <br>
                    Experience the game in a new perspective and play it in 3D mode.
                    <br>
                    You can also challenge yourself in the Endless Mode where you play until you lose or reach the end with each game getting more diffucult than the previous!
                </p>
                <div class="flex justify-between">
                    <div class="">
                        <p class="text-green-500 text-2xl">
                            Key Features:
                            <br>
                            <p class="text-white text-lg">
                                - Classic
                                <br>
                                - Hexagonal
                                <br>
                                - 3D
                                <br>
                                - Endless
                            </p>
                        </p>
                    </div>
                    <!-- STEAM LINK -->
                    <div class="flex items-center">
                        <a href="https://store.steampowered.com/app/2889270/Minesweeper_Extended/" target="_blank">
                            <img src="../Images/steam_logo.png" alt="SteamPage" class="w-20 border-2 border-zinc-800 rounded-full hover:scale-125 transition-transform duration-200 ease-in-out">
                        </a>
                    </div>
                </div>
                
            </section>

            <!-- WHY -->
            <aside class="md:w-2/5 bg-zinc-900 bg-opacity-90 p-4 my-8 md:my-0 rounded-md">
                <h2 class="text-3xl font-semibold mb-4 text-center text-green-500">Why?</h2>
                <div class="text-lg leading-8 py-2">
                    <p>
                        Minesweeper Extended is the first game I've published to Steam. It is a game I've occasionally played to pass time.
                        <br>
                        <br>
                        After getting into game development I thought it would be fun to learn how it was made and re-create it myself.
                        <br>
                        I decided to publish it to Steam to create a dedicated place you could play it from. 
                        <br>
                        <br>
                        As there are quite a lot of Minesweeper copies, both on steam and online, I decided to add some unique features I had not seen before.
                    </p>
                </div>
            </aside>
        </div>
        
        <!-- TRAILER LINK -->
        <div class="flex justify-center">
            <iframe class="my-8 border-2 border-zinc-900 bg-transparent place-self-center" width="800" height="450" src="https://www.youtube.com/embed/l0NXezpqKWc?si=DcXP09gjPbB0ADv0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        <!-- NAVIGATION BUTTONS-->
        <div class="navigation-bar">
            <button class="code-navigation-button text-2xl" onclick="scrollToElement('top')">↑</button>
            <button class="code-navigation-button" onclick="scrollToElement('grid-code-text')">GRID</button>
            <button class="code-navigation-button" onclick="scrollToElement('mines-code-text')">MINES</button>
            <button class="code-navigation-button" onclick="scrollToElement('numbers-code-text')">NUMBERS</button>
            <button class="code-navigation-button" onclick="scrollToElement('reveal-code-text')">REVEAL</button>
            <button class="code-navigation-button" onclick="scrollToElement('chord-code-text')">CHORD</button>
            <button class="code-navigation-button" onclick="scrollToElement('steamach-code-text')">STEAM ACHIEVEMENTS</button>
        </div>

        <!-- DIVIDER -->
        <div class="divider"></div>

        <div class="code-container">
            <!-- GRID CODE -->
            <section class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('grid-code-example')">
                ⇅
                </button>
                <pre id="grid-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
public class Grid
{
    private CellData[,] _grid;

    public int Width => _grid.GetLength(0);
    public int Height => _grid.GetLength(1);

    public CellData this[int x, int y] => _grid[x, y];
    public Grid(int width, int height)
    {
        _grid = new CellData[width, height];

        for (int x = 0; x &lt; _grid.GetLength(0); x++)
        {
            for (int y = 0; y &lt; _grid.GetLength(1); y++)
            {
                CellData cellData = ScriptableObject.CreateInstance&lt;CellData&gt;();
                _grid[x, y] = cellData;
                cellData.Position = new Vector3Int(x, y, 0);
                cellData.Type = CellData.CellType.Empty;
            }
        }
    }
}
                    </code>
                </pre>
            </section>

            <!-- GRID CODE TEXT -->
            <aside id="grid-code-text" class="code-text-section">
                <h2 class="code-text-heading">GRID</h2>
                <p class="leading-8">
                    The Grid class initializes a 2D array of Celldata objects.
                    <br>
                    Each object represents a cell, it is assigned a position within the grid and set to an empty cell as the default value.
                    <br>
                    Celldata is a Scriptable Object, which makes managing the values and properties of each cell a lot easier.
                </p>
            </aside>    
        </div>
        
        <!-- DIVIDER -->
        <div class="divider"></div>

        <div class="code-container">
            <!-- MINES CODE TEXT -->
            <section id="mines-code-text" class="code-text-section">
                <h2 class="code-text-heading">MINES</h2>
                <p class="leading-8">
                    Mines are generated on the first click of a cell.
                    <br>
                    A list of all valid cells is created, this does not include the first clicked cell and it's adjacent neighbors. 
                    The list is then shuffled.
                    <br>
                    Mines are placed by looping through the list until a set number has been placed.
                </p>
            </section>

            <!-- MINES CODE -->
            <aside class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('mines-code-example')">
                ⇅
                </button>
                <pre id="mines-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
public void CreateCellMines(CellData clickedCell, int amount)
{
    int width = Width;
    int height = Height;

    int placedAmount = 0;

    List&lt;Vector2Int&gt; validCells = new List&lt;Vector2Int&gt;();
    for (int x = 0; x &lt; width; x++)
    {
        for (int y = 0; y &lt; height; y++)
        {
            CellData cellData = _grid[x, y];

            // Exclude the clicked cell and its neighbors                
            if (!IsAdjacent(clickedCell, cellData) && 
            !(x == clickedCell.Position.x && y == clickedCell.Position.y))
            {
                validCells.Add(new Vector2Int(x, y));
            }
        }
    }

    // Shuffle the list of possible positions to randomize mine placement
    validCells = validCells.OrderBy(a => Random.value).ToList();

    // Place the mines
    for (int i = 0; i &lt; amount && validCells.Count > 0; i++)
    {
        Vector2Int pos = validCells[0];
        validCells.RemoveAt(0); // Remove the position to avoid placing another mine here
        _grid[pos.x, pos.y].Type = CellData.CellType.Mine;
        placedAmount++;
    }
}          
                    </code>
                </pre>
            </aside>
        </div>

        <!-- DIVIDER -->
        <div class="divider"></div>
        
        <div class="code-container">
            <!-- NUMBERS CODE -->
            <section class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('numbers-code-example')">
                ⇅
                </button>
                <pre id="numbers-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
public void CreateCellNumbers()
{
    int width = Width;
    int height = Height;

    for (int x = 0; x &lt; width; x++)
    {
        for (int y = 0; y &lt; height; y++)
        {
            CellData cellData = _grid[x, y];

            if (cellData.Type == CellData.CellType.Mine) continue;

            cellData.Number = GetAdjacentMines(cellData);
            cellData.Type = cellData.Number > 0 ? CellData.CellType.Number : CellData.CellType.Empty;
        }
    }
}
                    </code>
                </pre>
            </section>

            <!-- NUMBERS CODE TEXT -->
            <aside id="numbers-code-text" class="code-text-section">
                <h2 class="code-text-heading">NUMBERS</h2>
                    <p class="leading-8">
                        Numbers are generated based on the amount of adjacent mines to each cell.
                        <br>
                        The amount of adjacent mines is calculated and then stored in the celldata of the cell.
                        <br>
                        Mines are skipped, and cells with no adjacent mines are set as empty.
                    </p>
            </aside>
        </div>

        <!-- DIVIDER -->
        <div class="divider"></div>

        <div class="code-container">
            <!-- REVEAL CODE TEXT -->
            <section id="reveal-code-text" class="code-text-section">
                <h2 class="code-text-heading">REVEAL</h2>
                <p class="leading-8">
                    There are three outcomes when revealing a cell.
                    <p>
                        1. Mine -> Game over.
                        <br>
                        2. Number -> The cell is revealed.
                        <br>
                        3. Empty -> The cell and adjacent cells are revealed.
                    </p>
                    <br>
                    Revealing an area of cells is done by recursively checking if adjacent cells are either empty or a number.
                </p>
            </section>

            <!-- REVEAL CODE -->
            <aside class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('reveal-code-example')">
                ⇅
                </button>
                <pre id="reveal-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
private void RevealCellData(CellData cellData)
{
    if (cellData.IsRevealed || cellData.IsFlagged) return;
    
    switch (cellData.Type)
    {
        case CellData.CellType.Mine:
            ExplodeCells(cellData);
            _audioManager.PlayExplosion();
            break;
        case CellData.CellType.Empty:
            RevealArea(cellData);
            _audioManager.PlayRevealCell();
            CheckWinCondition();
            break;
        default:
            cellData.IsRevealed = true;
            _audioManager.PlayRevealCell();
            CheckWinCondition();
            break;
    }

    RefreshGame();
}


private void RevealArea(CellData cellData)
{
    if (_gameIsOver || cellData.IsRevealed || cellData.Type == CellData.CellType.Mine) return;

    Queue&lt;CellData&gt; cellsToReveal = new Queue&lt;CellData&gt;();
    HashSet&lt;CellData&gt; processedCells = new HashSet&lt;CellData&gt;();
    cellsToReveal.Enqueue(cellData);

    while (cellsToReveal.Count > 0)
    {
        CellData currentCell = cellsToReveal.Dequeue();
        if (currentCell.IsRevealed || processedCells.Contains(currentCell)) continue;

        currentCell.IsRevealed = true;
        processedCells.Add(currentCell);

        // If the cell is empty, enqueue all 8 surrounding cells
        if (currentCell.Type == CellData.CellType.Empty)
        {
            IEnumerable&lt;Vector2Int&gt; adjacentOffsets = GameModeManager.Instance.CurrentGameMode != GameModeManager.GameMode.Hex
                ? _grid.GetAllAdjacent()
                : _grid.GetAdjacentHex(currentCell);

            foreach (Vector2Int offset in adjacentOffsets)
            {
                int neighbourX = currentCell.Position.x + offset.x;
                int neighbourY = currentCell.Position.y + offset.y;

                if (_grid.TryGetCellData(neighbourX, neighbourY, out CellData adjacentCell))
                {
                    if (!adjacentCell.IsRevealed && adjacentCell.Type != CellData.CellType.Mine)
                        cellsToReveal.Enqueue(adjacentCell);
                }
            }
        }
    }
}  
                    </code>
                </pre>
            </aside>
        </div>

        <!-- DIVIDER -->
        <div class="divider"></div>

        <div class="code-container">
            <!-- CHORD CODE -->
            <section class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('chord-code-example')">
                ⇅
                </button>
                <pre id="chord-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
private void Unchord(CellData chord)
{
    chord.IsChorded = false;

    IEnumerable&lt;Vector2Int&gt; adjacentOffsets = GameModeManager.Instance.CurrentGameMode != GameModeManager.GameMode.Hex
            ? _grid.GetAllAdjacent()
            : _grid.GetAdjacentHex(chord);

    foreach (Vector2Int offset in adjacentOffsets)
    {
        int x = chord.Position.x + offset.x;
        int y = chord.Position.y + offset.y;

        if (_grid.TryGetCellData(x, y, out CellData cellData))
        {
            if (cellData.IsRevealed && cellData.Type == CellData.CellType.Number)
            {
                if (_grid.GetAdjacentFlags(cellData) >= cellData.Number)
                {
                    RevealCellData(chord);
                    return;
                }
            }
        }
            
    }
}
                    </code>
                </pre>
            </section>

            <!-- CHORD CODE TEXT -->
            <aside id="chord-code-text" class="code-text-section">
                <h2 class="code-text-heading">CHORD</h2>
                    <p class="leading-8">
                        Chording is used to reveal nearby cells.
                        <br>
                        If a revealed number cell has the same amount of adjacent flags as it's number, it can be chorded.
                        This will reveal all adjacent cells, excluding adjacent cells that are flagged.
                        <br>
                        If an adjacent cell turns out to be a mine, the game ends.
                    </p>
            </aside>
        </div>

        <!-- DIVIDER -->
        <div class="divider"></div>

       <div class="code-container">
        <!-- STEAM ACHIEVEMENTS CODE TEXT -->
        <section id="steamach-code-text" class="code-text-section">
            <h2 class="code-text-heading">STEAM ACHIEVEMENTS</h2>
            <p class="leading-8">
                The managaer is a singleton to ensure only one instance exists.
                <br>
                I use Steam's Steamworks API.
                <p>
                    - SetAchievement() method sets and saves an achievement.
                    <br>
                    - SetStats() method sets data for a stat and saves it. 
                    <br>
                    For example, if an achievement for 10 wins, would update the amount after each win, using SetStats().
                </p>
            </p>
        </section>

            <!-- STEAM ACHIEVEMENTS CODE -->
            <aside class="code-example-section">
                <button 
                class="toggleButton absolute top-10 right-10"
                onclick="toggleOverflow('steamach-code-example')">
                ⇅
                </button>
                <pre id="steamach-code-example" class="code-example-preview h-80">
                    <code class="language-csharp">
public class AchievementsManager : MonoBehaviour
{
    
    private static AchievementsManager _instance;

    public static AchievementsManager Instance
    {
        get { return _instance; }
    }

    private void Awake()
    {
        if (_instance == null)
        {
            _instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else
        {
            Destroy(gameObject);
        }
    }

    public void SetAchievement(string ach)
    {
        SteamUserStats.SetAchievement(ach);
        SteamUserStats.StoreStats();
    }

    public void SetStats(string stat, int data)
    {
        SteamUserStats.SetStat(stat, data);
        SteamUserStats.StoreStats();
    }

    public void ClearAllAchievements()
    {
        SteamUserStats.ResetAllStats(true);
    }

    public void ClearAchievement(string ach)
    {
        SteamUserStats.ClearAchievement(ach);
    }

    public void HasAchievement(string ach)
    {
        SteamUserStats.GetAchievement(ach, out bool achieved);
        Debug.Log($"Achievement: {ach}, Status: {achieved}");
    }
}
                          
                    </code>
                </pre>
            </aside>
        </div>

    </main>

    <script>
        function scrollToElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        }
    </script>

    <script>
        function toggleOverflow(id) {
            const preElement = document.getElementById(id);
            let height = "h-80";
            let fullHeight = "h-fit";

            if (preElement.classList.contains(height)) {
                preElement.classList.remove(height);
                preElement.classList.add(fullHeight);
            } else {
                preElement.classList.remove(fullHeight);
                preElement.classList.add(height);
            }
        }
    </script>
</body>
</html>
